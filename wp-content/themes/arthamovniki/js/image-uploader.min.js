!function(c){c.fn.imageUploader=function(e){let t={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:""},i=this;i.settings={},i.init=function(){i.settings=c.extend(i.settings,t,e),i.each(function(e,t){let a=n();if(c(t).append(a),a.on("dragover",l.bind(a)),a.on("dragleave",l.bind(a)),a.on("drop",p.bind(a)),i.settings.preloaded.length){a.addClass("has-files");let t=a.find(".uploaded");for(let e=0;e<i.settings.preloaded.length;e++)t.append(o(i.settings.preloaded[e].src,i.settings.preloaded[e].id,!0))}})};let d=new DataTransfer,n=function(){let e=c("<div>",{class:"image-uploader"}),t=c("<input>",{type:"file",id:i.settings.imagesInputName+"-"+r(),name:i.settings.imagesInputName+"[]",multiple:""}).appendTo(e),a=(c("<div>",{class:"uploaded"}).appendTo(e),c("<div>",{class:"upload-text"}).appendTo(e)),n=c("<div>",{class:"upload-footer"}).appendTo(e);c("<div>",{class:"btn btn--dynamic btn--full",text:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f"}).appendTo(n),c("<i>",{class:"material-icons",text:""}).appendTo(a),c("<span>",{text:i.settings.label}).appendTo(a);return e.on("click",function(e){s(e),t.trigger("click")}),t.on("click",function(e){e.stopPropagation()}),t.on("change",p.bind(e)),e},s=function(e){e.preventDefault(),e.stopPropagation()},o=function(e,t){let n=c("<div>",{class:"uploaded-image"}),a=(c("<img>",{src:e}).appendTo(n),c("<button>",{class:"delete-image"}).appendTo(n));c("<i>",{class:"material-icons",text:""}).appendTo(a);return i.settings.preloaded.length?(n.attr("data-preloaded",!0),c("<input>",{type:"hidden",name:i.settings.preloadedInputName+"[]",value:t}).appendTo(n)):n.attr("data-index",t),n.on("click",function(e){s(e)}),a.on("click",function(e){if(s(e),n.data("index")){let a=parseInt(n.data("index"));n.find(".uploaded-image[data-index]").each(function(e,t){e>a&&c(t).attr("data-index",e-1)}),d.items.remove(a)}n.remove(),n.find(".uploaded-image").length||n.removeClass("has-files")}),n},l=function(e){s(e),"dragover"===e.type?c(this).addClass("drag-over"):c(this).removeClass("drag-over")},p=function(e){s(e);let t=c(this);t.removeClass("drag-over");e=e.target.files||e.originalEvent.dataTransfer.files;a(t,e)},a=function(e,t){e.addClass("has-files");let a=e.find(".uploaded"),n=e.find('input[type="file"]');c(t).each(function(e,t){d.items.add(t),a.append(o(URL.createObjectURL(t),d.items.length-1))}),n.prop("files",d.files)},r=function(){return Date.now()+Math.floor(100*Math.random()+1)};return this.init(),this}}(jQuery);